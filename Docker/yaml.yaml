version: "3.9"

services:

  mongo:
    image: mongo:7
    container_name: mongo
    ports:
      - "27017:27017"
    volumes:
      - mongo_data:/data/db

  retriever:
    build: ./retriever
    container_name: retriever
    depends_on:
      - mongo
    environment:
      - MONGO_URI=mongodb://mongo:27017
    networks:
      - pipeline_net

  preprocessor:
    build: ./preprocessor
    container_name: preprocessor
    depends_on:
      - retriever
    networks:
      - pipeline_net

  enricher:
    build: ./enricher
    container_name: enricher
    depends_on:
      - preprocessor
    networks:
      - pipeline_net

  persister:
    build: ./persister
    container_name: persister
    depends_on:
      - enricher
      - mongo
    networks:
      - pipeline_net

volumes:
  mongo_data:

networks:
  pipeline_net:
    driver: bridge



#ğŸ”¹ ×”×¡×‘×¨ ×§×¦×¨
#
#services â†’ ×›×œ ×©×™×¨×•×ª ××§×‘×œ ×©×, ×ª××•× ×” ××• build, ××©×ª× ×™ ×¡×‘×™×‘×” ×•×¨×©×ª.
#
#depends_on â†’ ××‘×˜×™×— ×©×”×©×™×¨×•×ª×™× ×™×¨×•×¦×• ×œ×¤×™ ×¡×“×¨ ×ª×œ×•×ª.
#
#volumes â†’ ×××¤×©×¨ ×©××™×¨×” ×©×œ × ×ª×•× ×™× ×‘××•× ×’×• ×’× ××—×¨×™ ×¢×¦×™×¨×”.
#
#networks â†’ ×¨×©×ª ×¤× ×™××™×ª ×‘×™×Ÿ ×”×©×™×¨×•×ª×™×.
#
#2ï¸âƒ£ ××™×š ××¢×“×›× ×™× ××ª docker-compose.yml
#
#×›×œ ×¤×¢× ×©××ª×” ××©× ×”:
#
#Dockerfile ×©×œ ×©×™×¨×•×ª
#
#××©×ª× ×™ ×¡×‘×™×‘×”
#
#×ª×œ×•×ª ×‘×™×Ÿ ×©×™×¨×•×ª×™×
#
#ports ××• volumes
#
#××ª×” ×¤×©×•×˜:
#
#docker-compose up -d --build
#
#
#Compose ××–×”×” ×©×™× ×•×™×™× ×‘â€‘Dockerfile ××• ×‘×§×•×“ ×©×œ ×”×©×™×¨×•×ª×™×
#
#×‘×•× ×” ××—×“×© ×¨×§ ××ª ××” ×©×¦×¨×™×š
#
#××¨×™×¥ ××ª ×”×§×•× ×˜×™×™× ×¨×™× ×”×—×“×©×™× ×‘×¨×§×¢
#
#×× ×œ× ×©×™× ×™×ª ××ª Dockerfile ××• ×”×§×•×“ ×•××ª×” ×¨×§ ×¨×•×¦×” ×œ×”×¤×¢×™×œ ×©×™×¨×•×ª ×—×“×© ×©× ×•×¡×£ ×œÖ¾docker-compose.yml:
#
#docker-compose up -d
#
#
#Compose ×™×ª×—×‘×¨ ×œ×©×™×¨×•×ª×™× ×”×§×™×™××™×, ×™×¨×™×¥ ××ª ×”×—×“×© ×‘×œ×™ build ××—×“×©.
#
#ğŸ’¡ ×˜×™×¤ ×©×™××•×©×™:
#
#×ª××™×“ ×©××¨×• ×¢×•×ª×§ ×©×œ docker-compose.yml ×‘×ª×™×§×™×™×ª root ×©×œ ×”×¤×¨×•×™×§×˜.
#
#×× ××•×¡×™×¤×™× ×©×™×¨×•×ª ×—×“×©, ×¤×©×•×˜ ×”×•×¡×™×¤×• ××•×ª×• ×‘Ö¾services: ×•××– docker-compose up -d â€“ Compose ×™×˜×¤×œ ×‘×©××¨.


×”×•×¡×¤×ª Service ×—×“×© ×œÖ¾docker-compose.yml
ğŸ“Œ 1. ×©××™×¨×” ×¢×œ ××•×ª×• ×§×•×‘×¥ docker-compose.yml

×ª××™×“ ×¢×•×‘×“×™× ×¢× ××•×ª×• ×§×•×‘×¥ ××¨×›×–×™.

×›×œ ×©×™×¨×•×ª ×—×“×© = ×‘×œ×•×§ ×—×“×© ×ª×—×ª services.

ğŸ“Œ 2. ××‘× ×” ×¤×¨×•×™×§×˜ ××•××œ×¥

×›×œ ×©×™×¨×•×ª ×‘×ª×™×§×™×™×” ××©×œ×• ×¢× ×§×•×“ + Dockerfile:

project/
  docker-compose.yml
  service1/
    Dockerfile
    ...
  service2/
    Dockerfile
    ...
  service3/
    Dockerfile
    ...

ğŸ“Œ 3. ×”×•×¡×¤×ª Service ×—×“×©

× × ×™×— ×©×™×© ×œ×š ×›×‘×¨ backend ×•Ö¾frontend, ×•×¢×›×©×™×• ××ª×” ××•×¡×™×£ worker:

services:
  backend:
    build:
      context: ./backend
    networks:
      - my_network
    ports:
      - "5000:5000"

  frontend:
    build:
      context: ./frontend
    networks:
      - my_network
    ports:
      - "3000:3000"
    depends_on:
      - backend

  worker:
    build:
      context: ./worker
    networks:
      - my_network
    depends_on:
      - backend

networks:
  my_network:
    driver: bridge

ğŸ“Œ 4. ××” ×§×•×¨×” ××—×¨×™ ×©×”×•×¡×¤×ª Service ×—×“×©?

×œ×”×¨×™× ××ª ×›×œ ×”××¢×¨×›×ª (×›×•×œ×œ ×”×©×™×¨×•×ª ×”×—×“×©):

docker-compose up -d


×œ×”×¨×™× ×¨×§ ××ª ×”×©×™×¨×•×ª ×”×—×“×© (×‘×œ×™ ×œ×’×¢×ª ×‘××—×¨×™×):

docker-compose up -d worker


×× ×©×™× ×™×ª Dockerfile ×©×œ ×©×™×¨×•×ª ××¡×•×™× (×¦×¨×™×š rebuild):

docker-compose build worker
docker-compose up -d worker